<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°æŒ‡ç±Œç¢¼çµæ®º - é¦¬å¹´æ——è‰¦ç‰ˆ</title>
    <style>
        :root { --primary: #c2410c; /* é¦¬å¹´ç”¨æ©˜ç´…è‰²ç³» */ --bg: #fff7ed; --card: #ffffff; --text: #431407; --red: #dc2626; --green: #16a34a; --input-bg: #ffedd5; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); margin: 0; padding: 15px; color: var(--text); padding-bottom: 100px; }
        .container { max-width: 500px; margin: 0 auto; background: var(--card); border-radius: 20px; box-shadow: 0 10px 25px rgba(194, 65, 12, 0.15); overflow: hidden; }
        
        /* é¦¬å¹´åœ–ç‰‡å€ */
        .hero-img { width: 100%; height: 160px; object-fit: cover; display: block; }
        
        .content-pad { padding: 20px; }

        header { text-align: center; margin-bottom: 20px; }
        h1 { font-size: 24px; margin: 0; color: #9a3412; font-weight: 800; letter-spacing: -0.5px; }
        .subtitle { font-size: 13px; color: #ea580c; margin-top: 4px; font-weight: 500; }

        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .action-btn { flex: 1; padding: 12px; font-size: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-auto { background: linear-gradient(135deg, #ea580c, #c2410c); color: white; }
        .btn-auto:active { transform: scale(0.98); }
        .btn-clear { background: #f1f5f9; color: #64748b; max-width: 100px; }
        
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .section-title { font-size: 14px; font-weight: 700; color: #9a3412; border-left: 4px solid #ea580c; padding-left: 8px; margin: 25px 0 10px 0; }

        .input-row { display: flex; gap: 10px; margin-bottom: 12px; }
        .input-group { flex: 1; position: relative; }
        label { display: block; font-size: 12px; color: #7c2d12; margin-bottom: 4px; font-weight: 600; }
        
        input { width: 100%; padding: 12px; border: 2px solid transparent; border-radius: 12px; font-size: 18px; font-weight: 700; box-sizing: border-box; background: var(--input-bg); color: #431407; outline: none; transition: 0.2s; -webkit-appearance: none; text-align: center; }
        input:focus { background: #fff; border-color: #ea580c; box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.2); }
        input::placeholder { color: #fdba74; font-size: 14px; }

        .tx-input input { background: #fff7ed; border: 2px solid #ea580c; color: #c2410c; }
        .long-input input { color: var(--red); background: #fef2f2; }
        .short-input input { color: var(--green); background: #f0fdf4; }

        /* çµæœç‹€æ…‹æ¢ */
        .status-bar { background: #f1f5f9; padding: 15px; border-radius: 12px; text-align: center; margin-top: 20px; }
        .status-title { font-size: 13px; color: #64748b; margin-bottom: 5px; }
        .status-val { font-size: 28px; font-weight: 900; letter-spacing: -1px; }

        /* ç­–ç•¥è¡¨æ ¼ */
        .strategy-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .strategy-table th { background: #431407; color: white; padding: 10px; font-size: 13px; }
        .strategy-table td { padding: 12px; text-align: center; border-bottom: 1px solid #fed7aa; font-weight: bold; font-size: 15px; }
        .strategy-table tr:last-child td { border-bottom: none; }
        
        .row-200 { background: rgba(255, 255, 255, 0.5); }
        .row-300 { background: rgba(254, 215, 170, 0.2); }
        .row-400 { background: rgba(254, 215, 170, 0.4); }
        .row-500 { background: rgba(254, 215, 170, 0.6); }

        #status-msg { text-align: center; font-size: 12px; margin-bottom: 10px; min-height: 18px; font-weight: 500; color: #ea580c; }
    </style>
</head>
<body>

<div class="container">
    
    <img src="https://images.unsplash.com/photo-1598974357801-cbca100e65d3?q=80&w=1000&auto=format&fit=crop" class="hero-img" alt="é¦¬åˆ°æˆåŠŸ">

    <div class="content-pad">
        <header>
            <h1>ğŸ å°æŒ‡ç±Œç¢¼ - é¦¬åˆ°æˆåŠŸç‰ˆ</h1>
            <div class="subtitle">2026 é‡‘é¦¬å¥”é¨° â€¢ ç±Œç¢¼çµæ®ºç­–ç•¥</div>
        </header>

        <div class="btn-group">
            <button class="action-btn btn-auto" onclick="autoDetect()" id="autoBtn">
                <span id="btn-icon">âš¡</span> æŠ“å–ç¾åœ¨é»æ•¸
            </button>
            <button class="action-btn btn-clear" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>
        <div id="status-msg"></div>

        <div class="section-title">ğŸ“ åŸºæº–é»ä½</div>
        <div class="input-row">
            <div class="input-group">
                <label>åŠ æ¬ŠæŒ‡æ•¸ (åƒè€ƒ)</label>
                <input type="number" id="spot_price" placeholder="è‡ªå‹•æŠ“å–" disabled style="opacity:0.7">
            </div>
            <div class="input-group tx-input">
                <label>â­ å°æŒ‡æœŸ (è¨ˆç®—åŸºæº–)</label>
                <input type="number" id="tx_price" placeholder="è¼¸å…¥æœŸè²¨" oninput="saveAndCalc()">
            </div>
        </div>

        <div class="section-title">ğŸ‘¥ æ•£æˆ¶ç±Œç¢¼åˆ†ä½ˆ</div>
        <div class="input-row">
            <div class="input-group long-input">
                <label>å°å°å¤šå–®</label>
                <input type="number" id="mtx_long" placeholder="0" oninput="saveAndCalc()">
            </div>
            <div class="input-group short-input">
                <label>å°å°ç©ºå–®</label>
                <input type="number" id="mtx_short" placeholder="0" oninput="saveAndCalc()">
            </div>
        </div>
        <div class="input-row">
            <div class="input-group long-input">
                <label>å¾®å°å¤šå–®</label>
                <input type="number" id="tmf_long" placeholder="0" oninput="saveAndCalc()">
            </div>
            <div class="input-group short-input">
                <label>å¾®å°ç©ºå–®</label>
                <input type="number" id="tmf_short" placeholder="0" oninput="saveAndCalc()">
            </div>
        </div>

        <div class="status-bar" id="main-status-bar">
            <div class="status-title">æ•£æˆ¶ç¸½æ¬Šé‡æ·¨å–®</div>
            <div class="status-val" id="res-total">0</div>
            <div style="font-size:12px; margin-top:5px; color:#9ca3af;" id="res-trend">ç­‰å¾…è¨ˆç®—...</div>
        </div>

        <div class="section-title">ğŸ“Š ä¸»åŠ›ç›®æ¨™åƒ¹æ¨æ¼” (æ³¢å‹•åŠ‡æœ¬)</div>
        <div id="table-container">
            <table class="strategy-table">
                <thead>
                    <tr>
                        <th>æ³¢å‹• ATR</th>
                        <th>é ä¼°ç›®æ¨™åƒ¹</th>
                        <th>ä¸»åŠ›å‹•å‘</th>
                    </tr>
                </thead>
                <tbody id="scenario-body">
                    <tr><td colspan="3" style="color:#9ca3af; padding:20px;">è«‹å…ˆè¼¸å…¥ç±Œç¢¼æ•¸æ“š</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const fields = ['spot_price', 'tx_price', 'mtx_long', 'mtx_short', 'tmf_long', 'tmf_short'];

    window.onload = function() {
        fields.forEach(id => {
            const savedVal = localStorage.getItem(id);
            if (savedVal) document.getElementById(id).value = savedVal;
        });
        calculate();
    }

    async function autoDetect() {
        const btn = document.getElementById('autoBtn');
        const icon = document.getElementById('btn-icon');
        const status = document.getElementById('status-msg');
        
        btn.disabled = true;
        icon.classList.add('loading-spin');
        status.innerText = "æ­£åœ¨é€£ç·šäº¤æ˜“æ‰€...";
        
        try {
            const symbol = "%5ETWII"; 
            const timestamp = new Date().getTime();
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/' + symbol + '?interval=1d&range=2d&_=' + timestamp)}`;
            
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error("API Error");
            const data = await response.json();
            const result = JSON.parse(data.contents).chart.result[0];
            const lastClose = result.meta.regularMarketPrice;
            
            // å¡«å…¥æ•¸å€¼
            document.getElementById('spot_price').value = Math.round(lastClose);
            
            // å¦‚æœå°æŒ‡æœŸæ²’å¡«ï¼Œé è¨­å¡«å…¥å¤§ç›¤
            if(!document.getElementById('tx_price').value) {
                document.getElementById('tx_price').value = Math.round(lastClose);
            }

            saveAndCalc();
            status.innerText = `âœ… æ›´æ–°æˆåŠŸï¼ç›®å‰ç´„ ${Math.round(lastClose)}`;
            status.style.color = "#16a34a";
            
        } catch (error) {
            console.error(error);
            status.innerText = "âš ï¸ æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥";
            status.style.color = "#dc2626";
        } finally {
            btn.disabled = false;
            icon.classList.remove('loading-spin');
        }
    }

    function saveAndCalc() {
        fields.forEach(id => {
            const el = document.getElementById(id);
            if(el) localStorage.setItem(id, el.value);
        });
        calculate();
    }

    function clearAll() {
        if(confirm('æ¸…é™¤æ‰€æœ‰æ•¸æ“šï¼Ÿ')) {
            fields.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.value = '';
                localStorage.removeItem(id);
            });
            calculate();
        }
    }

    function calculate() {
        // å–å¾—åƒ¹æ ¼
        let spot = parseInt(document.getElementById('spot_price').value) || 0;
        let tx = parseInt(document.getElementById('tx_price').value);
        let basePrice = tx ? tx : spot; // è¨ˆç®—åŸºæº–
        
        // å–å¾—ç±Œç¢¼
        let mtx_L = parseInt(document.getElementById('mtx_long').value) || 0;
        let mtx_S = parseInt(document.getElementById('mtx_short').value) || 0;
        let tmf_L = parseInt(document.getElementById('tmf_long').value) || 0;
        let tmf_S = parseInt(document.getElementById('tmf_short').value) || 0;
        
        let mtx_net = mtx_L - mtx_S;
        let tmf_net_eq = (tmf_L - tmf_S) * 0.2; 
        let total_net = mtx_net + tmf_net_eq;
        
        // æ›´æ–°ä¸Šæ–¹ç‹€æ…‹
        const totalEl = document.getElementById('res-total');
        const trendEl = document.getElementById('res-trend');
        const statusBar = document.getElementById('main-status-bar');

        totalEl.innerText = total_net.toLocaleString('en-US', {maximumFractionDigits: 1});
        
        let direction = 0; // 0:ç›¤æ•´, 1:æ®ºå¤š(è·Œ), -1:è»‹ç©º(æ¼²)
        const THRESHOLD = 1500;

        if (total_net > THRESHOLD) {
            // æ•£æˆ¶å¤š -> è·Œ
            direction = 1; 
            totalEl.style.color = "#dc2626"; // æ•£æˆ¶å¤šå–®ç”¨ç´…è‰²é¡¯ç¤º
            trendEl.innerText = "âš ï¸ æ•£æˆ¶å¤§èˆ‰åšå¤šï¼Œä¸»åŠ›å¯èƒ½æ®ºç›¤";
            trendEl.style.color = "#dc2626";
            statusBar.style.borderLeft = "5px solid #16a34a"; // ç¶ è‰²ä»£è¡¨è·Œå‹¢æš—ç¤º

        } else if (total_net < -THRESHOLD) {
            // æ•£æˆ¶ç©º -> æ¼²
            direction = -1;
            totalEl.style.color = "#16a34a"; // æ•£æˆ¶ç©ºå–®ç”¨ç¶ è‰²é¡¯ç¤º
            trendEl.innerText = "ğŸš€ æ•£æˆ¶å¤§èˆ‰åšç©ºï¼Œä¸»åŠ›å¯èƒ½è»‹ç©º";
            trendEl.style.color = "#16a34a";
            statusBar.style.borderLeft = "5px solid #dc2626"; // ç´…è‰²ä»£è¡¨æ¼²å‹¢æš—ç¤º

        } else {
            direction = 0;
            totalEl.style.color = "#4b5563";
            trendEl.innerText = "âš–ï¸ ç±Œç¢¼å¹³è¡¡ï¼Œå€é–“éœ‡ç›ª";
            statusBar.style.borderLeft = "5px solid #9ca3af";
        }

        // ç”¢ç”Ÿè¡¨æ ¼
        renderTable(basePrice, direction);
    }

    function renderTable(price, direction) {
        const tbody = document.getElementById('scenario-body');
        tbody.innerHTML = "";

        if (price === 0) {
             tbody.innerHTML = `<tr><td colspan="3" style="color:#9ca3af; padding:20px;">è«‹è¼¸å…¥å°æŒ‡æœŸé»æ•¸</td></tr>`;
             return;
        }

        if (direction === 0) {
            tbody.innerHTML = `<tr><td colspan="3" style="padding:20px; color:#4b5563;">ç›®å‰ç±Œç¢¼ç„¡æ˜é¡¯æ”»æ“Šæ–¹å‘<br>å»ºè­°è§€æœ›æˆ–åšå€é–“</td></tr>`;
            return;
        }

        const atrs = [200, 300, 400, 500];
        
        atrs.forEach(atr => {
            let target = 0;
            let actionText = "";
            let colorClass = "";
            let rowClass = `row-${atr}`;

            if (direction === 1) {
                // æ®ºç›¤ (è·Œ)
                target = price - atr;
                actionText = `æ®º ${atr} é»`;
                colorClass = "color: #16a34a;"; // ç¶ å­— (è·Œ)
            } else {
                // è»‹ç©º (æ¼²)
                target = price + atr;
                actionText = `æ‹‰ ${atr} é»`;
                colorClass = "color: #dc2626;"; // ç´…å­— (æ¼²)
            }

            const row = `
                <tr class="${rowClass}">
                    <td style="color:#7c2d12;">ATR ${atr}</td>
                    <td style="font-size:18px; ${colorClass}">${target}</td>
                    <td style="font-size:13px; ${colorClass}">${actionText}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }
</script>
</body>
</html>
